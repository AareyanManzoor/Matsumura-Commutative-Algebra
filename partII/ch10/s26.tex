\documentclass[../main]{subfiles}
\begin{document}

\section{Derivations and Differentials}\label{sec:26}

\newparagraph Let $A$ be a ring and $M$ an $A$-module. A \defemph{derivation}\index{derivation} $D$ of $A$ into $M$ is defined as usual: it is an additive map from $A$ to $M$ satisfying \newline $D(a b)=a D b+b D a$. The set of all derivations of $A$ into $M$ is denoted by $\Der(A, M)$; it is an $A$-module in the natural way.

For any derivation $D$, $D^{-1}(0)$ is a subring of $A$ (in particular, $D(1)=0$: this follows from $1^2=1$.) If $A$ is a field, then $D^{-1}(0)$ is a subfield. 

Let $k$ be a ring and $A$ a $k$-algebra. Then derivations $A \varrightarrow{} M$ which vanish on $k\cdot1_A$ are called \defemph{derivations over $k$}. The set of such derivations is denoted by $\Der_k(A, M)$. We write $\Der_k(A)$ for $\Der_k(A, A)$.

Suppose that $A$ is a ring whose characteristic is a prime number $p$, and let $A^p$ denote the subring $\{a^p \mid a \in A\}$. Then any derivation $D:A \varrightarrow{} M$ vanishes on $A^p$, for $D(a^p)=pa^{p-1} D(a) =0$.

\newparagraph Let $A$ and $C$ be rings and $N$ an ideal of $C$ with $N^2=0$. Let \newline $j: C \varrightarrow{} C / N$ be the natural map, Let $u, u': A \varrightarrow{} C$ be two homomorphisms (of rings) satisfying $ju =j u'$, and put $D= u'-u$. Then $u$ and $u'$ induce the same $A$-module structure on $N$, and $D: A \varrightarrow{} N$ is a derivation. In fact, we have
\[
\begin{aligned}
u'(a b)=u'(a) u'(b) &=(u(a)+D(a))(u(b)+D(b)) \\
&=u(a b)+a D(b)+b D(a)
\end{aligned}
\]
Conversely, if u: $A \varrightarrow{} C$ is a homomorphism and $D: A \varrightarrow{} N$ is a derivation (with respect to the $A$-module structure on $N$ induced by $u$), then $u'=u+D$ is a homomorphism.

\newparagraph Let $k$ be a ring, $A$ a $k$-algebra and $B=A \otimes_k A$. Consider the homomorphisms of $k$-algebras
\[\begin{aligned}
\varepsilon:& B \varrightarrow{} A & \lambda_1:& A \varrightarrow{} B & \lambda_2:&A\varrightarrow{}B\\
&(a\otimes a') \mapsto aa' & &a\mapsto a\otimes 1 & & a \mapsto 1 \otimes a 
\end{aligned}\]
Once and for all, we make $B=A \otimes A$ an $A$-algebra via $\lambda_1$. We denote the kernel of $\varepsilon$ by $I_{A / k}$ or simply by $I$, and we put $I / I^2=\Omega_{A / k}$. The $B$-modules $I$, $I^2$ and $\Omega_{A/k}$ are also viewed as $A$-modules via $\lambda_1: A \varrightarrow{} B$. Then the $A$-module $\Omega_{A/k}$ is called the \defemph{module of differentials}\index{differential!\indexline module} (or \defemph{of KÃ¤hler differentials}) of $A$ over $k$.

We have $\varepsilon \lambda_1=\varepsilon \lambda_2=\id_A$. Therefore, if we denote. the natural homomorphism $B \varrightarrow{} B / I^2$ by $\nu$ and if we put $\dd^\ast=\lambda_2-\lambda_1$ and $\dd=\nu \dd^*$, then we get a derivation $\dd: A \varrightarrow{} \Omega_{A / k}$. Note that we have $B=\lambda_1(A) \oplus I$, hence $B / I^2=\nu \lambda_1(A) \oplus \Omega_{A / k}$ (as $A$ module). Identifying $\nu \lambda_1(A)$ with $A$, we get
\[
B / I^2=A \oplus \Omega_{A/k}.
\]
In other words, $B / I^2$ is a trivial extension of $A$ by $\Omega_{A/k}$

\begin{proposition}\label{prop:26.01}
The pair $(\Omega_{A/k}', \dd)$ has the following universal property: if $D$ is a derivation of $A$ over $k$ into an $A$-module $M$, then there is a unique $A$-linear map $f: \Omega_{A / k} \varrightarrow{} M$ such that $D=f \dd$
\end{proposition}
\begin{proof}
In $B=A \otimes A$ we have \[x \otimes y=x y \otimes 1+x(1 \otimes y-y \otimes 1)=\varepsilon(x \otimes y)+x \dd^\ast y.\] Therefore, if $\sum x_i \otimes y_1 \in I=\Ker(\varepsilon)$ then $\sum x_i \otimes y_i=\sum x_i d^{\ast} y_i$. Since $\dd^\ast y \mod I^2=\dd y$, any element of $\Omega= I/ I^2$ has the form $\sum x_i \dd y_i\for{x_i, y_i\in A}$. In other words, $\Omega$ is generated by $\{\dd y \mid y \in A\}$ as $A$-module. This proves the uniqueness of $f$. As for the existence of $f$, take the trivial extension $A\ast M$ and define a homomorphism of $A$-algebras \[\phi: B=A \otimes_k A \varrightarrow{} A \ast M\] by $\phi(x \otimes y)=(x y, x D(y))$. Since $\phi(I) \subseteq M$ and $M^2=0$, we have $\phi(I^2)=0$ so that $\phi$ induces a homomorphism $\overline{\phi}$ of $A$-algebras $B / I^2=A * \Omega \varrightarrow{} A \ast M$ which maps $\dd y \in \Omega$ to \[\phi(\dd^* y)=\phi(1 \otimes y-y \otimes 1)=(0, D y).\] Thus the restriction of $\overline{\phi}$ to $\Omega$ gives an $A$-linear map \newline $f: \Omega \varrightarrow{} M$ with $f \circ \dd=D$.
\end{proof}

As a consequence of the proposition we get a canonical isomorphism of $A$-modules
\[
\Der_k(A, M) \simeq \Hom_A(\Omega_{A/k}, M) .
\]
In the categorical language, the pair $(\Omega_{A/k}, \dd)$ represents the covariant functor $M \mapsto \Der_k(A, M)$ from the category of $A$-modules into itself. The map \newline $\dd: A \varrightarrow{} \Omega_{A / k}$ is called the canonical derivation and is denoted by $\dd_{A / k}$ if necessary.

\newparagraph Any ring $A$ is a $\bZ$-algebra in a unique way. The module $\Omega_{A / \bZ}$ is simply written $\Omega_A$. If $A$ contains a field $k$ and if $F$ is the prime field in $k$, then $\Omega_{A / F}=\Omega_A$ because $A \otimes_\bZ A=A \otimes_F A$.

The $r$-th exterior product $\bigwedge^r \Omega_{A / k}$ is denoted by $\Omega^r A / k$ and is called the module of differentials of degree $r$. In this notation we have $\Omega_{A / k}=\Omega^1_{A / k}$.

\begin{parexample}\label{exa:26.01}
Let $k$ be a ring, and let $A$ be a $k$-algebra which is generated by a set of elements $\{x_\lambda\}$ over $k$. Then
$\Omega_{A / k}$ is generated by $\{\dd x_\lambda\}$ as $A$-module. This is clear since $\dd$ is a derivation.
 

In particular, if $A$ is a polynomial ring over the ring $k$ in an arbitrary number of indeterminates $\{x_\lambda\}: A=k[\dots, x_\lambda, \dots]$, then $\Omega_{A / k}$ is a free $A$-module with $\{\dd X_\lambda\}$ as a basis. In fact, suppose $\sum P_\lambda \dd X_\lambda=0 \for{P_\lambda \in A}$ and let $\pdv{}{X_\lambda}$ denote the partial derivations. Then $\pdv{}{X_\lambda} \in \Der_k(A)$, hence there exists a linear map $f: \Omega_{A / k} \varrightarrow{} A$ such that \[f(\dd X_{\mu})=\pdv{X_\mu}{X_\lambda}=\delta_{\lambda \mu}. \] Applying $f$ to $\sum P_{\mu} \dd X_{\mu}=0$ we find $P_\lambda=0$. As $\lambda$ is arbitrary we see that the $\dd x_\lambda'$s are linearly independent over $A$. $\square$

Note that \[\Der_k(A)=\Hom_A(\Omega_{A/k}, A) \simeq \prod_\lambda A_\lambda\text{ where } A_\lambda \simeq A.\] 
\end{parexample}

\begin{parexample}\label{exa:26.02}
Let $k$ be a field of characteristic $p>0$, and let $k'$ be a subfield such that $k=k'(t)$, $t^p=a \in k'$, $t \neq k'$. Then $k=k'[X] /(X^p-a)$, and since $\pdv{X^p-a}X= 0$ the derivation $\pdv{}{X}$ of $k'[X]$ maps the ideal $(X^p-a) k'[X]$ into itself. It thus induces a derivation $D$ of $k$ over $k'$ such that $D(t)=1$.

Next, let $k'$ be an arbitrary subfield such that $k^p \subseteq k'\subseteq k$. $A$ family of elements $(x_\lambda)$ of $k$ is said to be \defemph{$p$-independent over $k'$} if, for any finite subset $\{x_{\lambda_1}, \dots, x_{\lambda_n}\}$, we have \[[k'(x_{\lambda_1}, \dots, x_{\lambda_n}): k']=p^n.\] $A$ family $(x_\lambda)$ is called a \defemph{$p$-basis}\index{p-basis@$p$-basis} of $k$ over $k'$ if it is $p$-independent over $k'$ and if $k'(\dots, x_\lambda, \dots)=k$. The existence of a $p$-basis of $k$ over $k'$ can be easily proved by Zorn's lemma. Moreover, any $p$-independent family over $k'$ can be extended to a $p$-basis. Suppose that we are given a $p$-basis $(x_\lambda)$. Then $\Omega_{k / k'}$ is a free $k$-module with $(\dd x_\lambda)$ as a basis. In fact, putting $k_\lambda'=k'(\{x_{\mu} \mid \mu \neq \lambda\})$ we have $k_\lambda'(x_\lambda)=k,\quad x_\lambda^p \in k_\lambda'$ and $x_\lambda \notin k_\lambda'$, so there exists a derivation $D_\lambda$ of $k$ over $k_\lambda'$ such that $D_\lambda(x_\lambda)=1$. Therefore $D_\lambda \in \Der_{k'}(k)$ and $D_\lambda(x_{\mu})=\delta_{\lambda \mu}$. From this we conclude the linear independence of the $\dd x_\lambda' s$ as in Example \ref{exa:26.01}.

If $k^p \subseteq k' \subseteq k$ and $[k: k']=p^m<\infty$, then $\Omega_{k / k'}$ and $\Der_{k'}(k)$ are vector spaces of rank $m$, dual to each other.

In general, if $k'$ is an arbitrary subfield of $k$ and $x_1$, $\dots, x_n \in k$, then the differentials $\dd x_1, \dots, \dd x_n$ in $\Omega_{k / k'}$ are linearly independent over $k$ iff the family $(x_i)$ is $p$-independent over $k'(k^P)$. Proof is left to the reader.
\end{parexample}

\begin{parexample}
    Let $k$ be a field and $K$ a separable algebraic extension field of $k$. Then $\Omega_{K/k}=0$. In fact, for any $\alpha \in K$ there is a polynomial $f(X) \in k[X]$ such that $f(\alpha)=0$ and $f'(\alpha) \neq 0$. Since $d: k \varrightarrow{} \Omega_{K / k}$ is a derivation we have \[0=d(f(\alpha))=f'(\alpha) d \alpha,\] whence $d \alpha=0$. As $\Omega_{K / k}$ is generated by the $\dd \alpha$'s we get $\Omega_{K / k}=0$
\end{parexample} 

\begin{exercise}
\begin{enumerate}[label = \arabic*)]
    \item\label{exe:26.01} If \[\begin{tikzcd}A \arrow[r] &A' \\ k \arrow[u] \arrow[r] &k'\arrow[u] \end{tikzcd}\] is a commutative diagram of rings and homomorphisms, then there is a natural homomorphism of $A$-modules $\Omega_{A / k} \varrightarrow{} \Omega_{A^1 / k^1}$, hence also a natural homomorphism of $A'$-modules $\Omega_{A / k} \otimes_AA' \varrightarrow{} \Omega_{A' / k^1}$

    \item\label{exe:26.02} If $A'=A\otimes_k B'$ in 1), then the last homomorphism is an isomorphism: \[\Omega_{A' / k'}=\Omega_{A / k} \otimes_k k'=\Omega_{A / k} \otimes_A A'.\]

    \item\label{exe:26.03} If $S$ is a multiplicative set in a $k$-algebra $A$ and if $A'=S^{-1} A$, then \[\Omega_{A' / k}=\Omega_{A / k} \otimes_A A'=S^{-1} \Omega_{A / k}.\]
\end{enumerate}
\end{exercise}

\begin{partheorem}[The first fundamental exact sequence]\label{thm:057}
Let $k, A$ and $B$ be rings and let $k \varrightarrow{\phi} A \varrightarrow{\psi} B$ be homomorphisms. Then
\begin{enumerate}
    \item there is an exact sequence of natural homomorphisms of $B$-modules \[\Omega_{A / k} \otimes_A B\varrightarrow{v} \Omega_{B / k} \varrightarrow{u} \Omega_{B / A} \varrightarrow{} 0 ;\]
    
    \item the map $v$ has a left inverse (or what amounts to the same, $v$ is injective and $\Im(v)$ is a direct summand of $\Omega_{B / A}$ as $B$-module) iff any derivation of $A$ over $k$ into any $B$-module $T$ can be extended to a derivation $B \varrightarrow{} T$.
\end{enumerate}
\end{partheorem}

\begin{proof}
\begin{enumerate}
    \item The map $v$ is defined by $v(\dd_{A / k}(a) \otimes b)=b \cdot \dd_{B / k} \psi(a)$, and the map $u$ by \[u(b \cdot \dd_{B / k}(b'))=b \cdot \dd_{B / A}(b')\for{a \in A ; b, b' \in B}.\] It is clear that $u$ is surjective. Since $\dd_{B / A} \psi(a)=0$ we have $u v=0$. It remains to prove that $\Ker(u)=\Im(v)$. To do this, it is enough to show that \[\Hom_B(\Omega_{A/k} \otimes_A B, T)\longleftarrow\Hom_B(\Omega_{B/ k}, T)\longleftarrow\Hom_B(\Omega_{B / A}, T)\]
    is exact for any $B$ module $T$ (take $T=\Coker(v)$). But we have canonical isomorphisms \[\Hom_B(\Omega_{A/k}\otimes_A B, T) \simeq \Hom_A(\Omega_{A/k}, T) \simeq\Der_k(A, T)\] etc., so we can identify the last sequence with \[\Der_k(A, T)\longleftarrow\Der_k(B, T)\longleftarrow\Der_A(B, T)\] where the first arrow is the map $D \mapsto D \circ \psi$. This sequence is exact by the definitions.
    
    \item A homomorphism of $B$-modules $M' \varrightarrow{} M$ has a left inverse iff the induced map $\Hom_B(M', T)\longleftarrow\Hom_B(M, T)$ is surjective for any $B$-module $T$. Thus, $v$ has a left inverse iff the natural map $\Der_k(A, T)\longleftarrow\Der_k(B, T)$ is surjective for any $B$-module $T$.
\end{enumerate}
\end{proof}

\begin{corollary}\label{cor:26.01}
The map $v: \Omega_{A / k} \otimes_A B \varrightarrow{} \Omega_{B / k}$ is an isomorphism iff any derivation of $A$ over $k$ into any $B$-module $T$ can be extended uniquely to a derivation $B \varrightarrow{} T$.
\end{corollary}
 
\newparagraph Let $k$ be a ring, $A$ a $k$-algebra, $\ideal{m}$ an ideal of $A$ and $B=A / \ideal{m}$. Define a map $\ideal{m} \varrightarrow{} \Omega_{A/k} \otimes_A B$ by $x \mapsto \dd_{A / k} x \otimes 1\for{x \in M}$. It sends $\ideal{m}^2$ to $0$, hence induces a $B$-linear map $\delta: \ideal{m}/\ideal{m}^2 \varrightarrow{} \Omega_{A/k}\otimes_A B.$

\begin{theorem}[The second fundamental exact sequence]\label{thm:058}
Let the notation be as above.
\begin{enumerate}
    \item The sequence of $B$-module \[\tag{*}\label{eqn:26.*} \ideal{m}/\ideal{m}^2 \varrightarrow{\delta}\Omega_{A/k}\otimes_AB \varrightarrow{v}\Omega_{B/k} \varrightarrow{}0\] is exact.
    \item Put $A_1 =A/\ideal{m}^2$. Then $\Omega_{A/k} \otimes_A B \simeq \Omega_{A_1/k}\otimes_{A_1}B.$
    \item The homomorphism $\delta$ has a left inverse iff the extension
\[0 \varrightarrow{} \ideal{m} / \ideal{m}^2\varrightarrow{}A_1 \varrightarrow{} B \varrightarrow{} 0\] of the $k$-algebra $B$ by $\ideal{m}/\ideal{m}^2$ is trivial over $k$.
\end{enumerate}
\end{theorem}

\begin{proof}
\begin{enumerate}
    \item The surjectivity of $v$ follows from that of $A \varrightarrow{} B$. Obviously the composite $v \delta=0$, So, as in the proof of the preceding theorem, it is enough to prove the exactness of \[\Hom_B(\ideal{m}/\ideal{m}^2, T)\longleftarrow\Hom_B(\Omega_{A / k} \otimes_A B, T)\longleftarrow\Hom_B(\Omega_{B / A}, T)\] for any $B$-module $T$. But we can rewrite it as follows: \[\Hom_A(\ideal{m}, T)\longleftarrow\Der_k(A, T)\longleftarrow\Der_k(A / \ideal{m}, T)\] where the first arrow is the map $D \mapsto D \mid \ideal{m} \for{D\in \Der_k(A, T)}$. Then the exactness is obvious.

    \item $A$ homomorphism of $B$-modules $N' \varrightarrow{} N$ is an isomorphism iff the induced map $\Hom_B(N', T) \longleftarrow \Hom_B(N, T)$ is an isomorphism for every $B$-module $T$. Applying this to the present situation we are led to prove that the natural map $\Der_k(A, T)\longleftarrow \Der_k(A / \ideal{m}^2,T)$, is an isomorphism for every $A/\ideal{m}$-module $T$, which is obvious.

    \item By (ii) we may replace $A$ by $A_1$ in (\ref{eqn:26.*}), so we assume $\ideal{m}^2=0$. Suppose that $\delta$ has a left inverse $w: \Omega_{A / k} \otimes_A B \varrightarrow{} \ideal{m}$. Putting $Da =w(\dd a \otimes 1)$ for $a\in A$ we obtain a derivation $D: A\varrightarrow{} \ideal{m}$ over $k$ such that $D x=x$ for $x \in \ideal{m}$. Then the map $f: A \varrightarrow{} A$ given by $f(a)=a-Da$ is a homomorphism of $k$-algebras and satisfies $f(\ideal{m})=0$, hence induces a homomorphism $\overline{f}: B=A / \ideal{m}\varrightarrow{}A$. Since $f(a) \equiv a \mod \ideal{m}$, the homomorphism $\overline{f}$ is a section of the ring extension \[0 \varrightarrow{} \ideal{m} \varrightarrow{} A \varrightarrow{} B \varrightarrow{} 0.\] The converse is proved by reversing the argument.
\end{enumerate}
\end{proof}

\begin{parexample}
    Let $k$ be a ring, $A$ a $k$-algebra and \newline $B=A[X_1.$, $.\dots, X_n]$. Let $T$ be an arbitrary $B$-module and let $D \in \Der_k(A, T)$. Then we can extend it to a derivation $B \varrightarrow{} T$ by putting $D(P(X))=P^D(X)$, where $P^D$ is obtained from $P(X)$ by applying $D$ to the coefficients. Thus the natural map \newline $\Omega_{A / k} \otimes_A B \varrightarrow{} \Omega_{B / k}$ has a left inverse, and we have \[\Omega_{B / k} \simeq(\Omega_{A / k} \otimes_A B) \oplus B\dd X_1 \oplus \dots \oplus B \dd X_n\] Let $\ideal{m}$ be an ideal of $B=A[X_1, \dots, X_n]$, and put $C=B / \ideal{m}, x_i=X_i \mod M$. Then we have the second fundamental exact sequence \[ \ideal{m}/ \ideal{m}^2 \varrightarrow{\delta} \Omega_{B / k} \otimes_B C=(\Omega_{A/k} \otimes_A C) \oplus \sum C\dd x_i \varrightarrow{} \Omega_{C / k} \varrightarrow{} 0\] with \[\delta(P(X))=(\dd P)(x)+\sum_{i=1}^n \pdv{P}{X_i}(x) \dd X_i \for{P(X) \in \ideal{m}},\] where $(\dd P)(x)$ is obtained by applying $\dd_{A / k}$ to the coefficients of $P(X)$ and then reducing the result modulo $\ideal{m}$.
\end{parexample}

\begin{exercise}\label{exe:26.04}
    Let $B=k[X, Y] /(Y^2-X^3)=k[x, y]$ (= the affine ring of the plane curve $y^2=x^3$, which has a cusp at the origin). Calculate $\Omega_{B/k}$, and show that it is a $B$-module torsion.
\end{exercise}
\end{document}